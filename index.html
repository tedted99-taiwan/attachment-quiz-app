<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¾æˆ€å±¬æ€§å°ˆæ¥­åˆ†ææ¸¬é©— - é»‘æ£®æ—å¤§å”</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <!-- å¼•å…¥ Chart.js ç”¨æ–¼ç¹ªåœ– -->
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap');
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f0f2f5; }
        .slider { -webkit-appearance: none; width: 100%; height: 8px; background: #ddd; border-radius: 5px; outline: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 22px; height: 22px; background: #4f46e5; border-radius: 50%; cursor: pointer; transition: 0.2s; }
        .slider::-webkit-slider-thumb:hover { transform: scale(1.1); }
        
        /* åº§æ¨™åœ–æ¨£å¼ */
        .quadrant-grid {
            position: relative;
            width: 300px;
            height: 300px;
            border: 2px solid #333;
            margin: 0 auto;
            background-image: 
                linear-gradient(#ccc 1px, transparent 1px),
                linear-gradient(90deg, #ccc 1px, transparent 1px);
            background-size: 150px 150px;
            background-position: -2px -2px;
        }
        .axis-label { position: absolute; font-size: 12px; color: #666; font-weight: bold; }
        .dot {
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: #ef4444;
            border: 2px solid white;
            border-radius: 50%;
            transform: translate(-50%, 50%); /* ä¿®æ­£åº§æ¨™ä¸­å¿ƒé» */
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: all 1s ease-out;
        }
        
        /* å•†æ¨™æ¨£å¼ */
        .brand-logo {
            font-size: 1.5rem; /* èª¿æ•´å•†æ¨™å­—é«”å¤§å° */
            font-weight: 700;   /* ç²—é«” */
            color: #4f46e5;     /* ä½¿ç”¨èˆ‡ä¸»é¡Œä¸€è‡´çš„é¡è‰² */
            text-align: center;
            margin-bottom: 1rem; /* å¢åŠ èˆ‡æ¨™é¡Œçš„é–“è· */
            letter-spacing: 0.1em; /* å¢åŠ å­—è· */
        }
    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">

    <div class="w-full max-w-2xl bg-white shadow-xl rounded-2xl p-6 md:p-10 my-8">
        
        <!-- å•†æ¨™ -->
        <div class="brand-logo">
            é»‘æ£®æ—å¤§å”
        </div>

        <header class="text-center mb-10">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">ä¾æˆ€å±¬æ€§å°ˆæ¥­åˆ†æ</h1>
            <p class="text-gray-500">è«‹æ ¹æ“šæ‚¨çš„çœŸå¯¦æ„Ÿå—ï¼Œåœ¨ä»¥ä¸‹é™³è¿°å¥ä¸­é¸æ“‡æ‚¨çš„åŒæ„ç¨‹åº¦ã€‚</p>
            <p class="text-gray-500">ï¼»æœ¬æ¸¬è©¦çµæœåƒ…ä¾›åƒè€ƒï¼Œå¦‚éœ€æº–ç¢ºè©•ä¼°è«‹å°‹æ±‚å°ˆæ¥­è«®è©¢ï¼½</p>
            
            <div id="loading-indicator" class="mt-4 text-sm text-indigo-500 font-semibold animate-pulse">
                æ­£åœ¨é€£ç·šè‡³åˆ†æè³‡æ–™åº«...
            </div>
            <!-- ç§»é™¤äº†ç´¯ç©äººæ•¸é¡¯ç¤º -->
        </header>

        <div id="questions-list" class="space-y-8">
            <!-- å•é¡Œæ’å…¥é» -->
        </div>
        
        <div class="mt-12">
            <button id="submit-button" class="w-full py-4 bg-indigo-600 text-white text-lg font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition-all transform hover:-translate-y-1 disabled:bg-gray-400 disabled:cursor-not-allowed" onclick="calculateAndSaveResult()" disabled>
                æŸ¥çœ‹è©³ç´°åˆ†æå ±å‘Š
            </button>
            <p id="error-message" class="hidden mt-3 text-center text-red-500 font-medium"></p>
        </div>

    </div>

    <!-- çµæœæ¨¡æ…‹æ¡† -->
    <div id="result-modal" class="hidden fixed inset-0 bg-gray-900/90 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden my-8">
            
            <!-- å ±å‘Šæ¨™é¡Œ -->
            <div class="bg-indigo-600 p-6 text-center">
                <!-- çµæœé é¢çš„å•†æ¨™ -->
                <div class="brand-logo text-white mb-2" style="font-size: 1.2rem;">
                    é»‘æ£®æ—å¤§å”
                </div>
                <h2 class="text-2xl font-bold text-white">æ‚¨çš„ä¾æˆ€å±¬æ€§åˆ†æå ±å‘Š</h2>
            </div>

            <div class="p-6 md:p-8 space-y-6">
                
                <!-- çµæœæ¨™é¡Œ -->
                <div class="text-center">
                    <p class="text-gray-500 text-sm uppercase tracking-wide">åˆ†æçµæœ</p>
                    <h3 id="result-title" class="text-4xl font-extrabold text-gray-800 mt-1"></h3>
                    <p id="result-subtitle" class="text-indigo-600 font-medium mt-2 text-lg"></p>
                </div>

                <!-- è¦–è¦ºåŒ–åº§æ¨™åœ– -->
                <div class="flex flex-col items-center justify-center py-4 bg-gray-50 rounded-xl border border-gray-200">
                    <p class="text-xs text-gray-400 mb-2">åº§æ¨™åˆ†ä½ˆåœ–</p>
                    <div class="quadrant-grid relative">
                        <!-- è»¸æ¨™ç±¤ -->
                        <span class="axis-label top-2 left-1/2 -translate-x-1/2">é«˜ç„¦æ…®</span>
                        <span class="axis-label bottom-2 left-1/2 -translate-x-1/2">ä½ç„¦æ…®</span>
                        <span class="axis-label top-1/2 right-2 -translate-y-1/2">é«˜è¿´é¿</span>
                        <span class="axis-label top-1/2 left-2 -translate-y-1/2">ä½è¿´é¿</span>
                        
                        <!-- è±¡é™æ¨™ç±¤ -->
                        <span class="absolute top-8 right-8 text-xs text-red-300 font-bold">æ··äº‚å‹</span>
                        <span class="absolute top-8 left-8 text-xs text-orange-300 font-bold">ç„¦æ…®å‹</span>
                        <span class="absolute bottom-8 right-8 text-xs text-blue-300 font-bold">é€ƒé¿å‹</span>
                        <span class="absolute bottom-8 left-8 text-xs text-green-300 font-bold">å®‰å…¨å‹</span>

                        <!-- ä½¿ç”¨è€…è½é» -->
                        <div id="user-dot" class="dot" style="bottom: 50%; left: 50%;"></div>
                    </div>
                </div>

                <!-- åˆ†æ•¸è©³æƒ… -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-red-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-red-600 font-bold">ç„¦æ…®æŒ‡æ•¸ (Anxiety)</p>
                        <p id="score-anxiety" class="text-3xl font-black text-red-700">0</p>
                        <p class="text-xs text-red-400 mt-1">æ»¿åˆ† 50</p>
                    </div>
                    <div class="bg-blue-50 p-4 rounded-lg text-center">
                        <p class="text-sm text-blue-600 font-bold">è¿´é¿æŒ‡æ•¸ (Avoidance)</p>
                        <p id="score-avoidance" class="text-3xl font-black text-blue-700">0</p>
                        <p class="text-xs text-blue-400 mt-1">æ»¿åˆ† 50</p>
                    </div>
                </div>

                <!-- æ–‡å­—è§£é‡‹ -->
                <div id="result-description" class="text-gray-700 leading-relaxed bg-gray-50 p-5 rounded-lg border-l-4 border-indigo-500">
                    <!-- æè¿° -->
                </div>

                <!-- ç§»é™¤äº†çµæœé é¢çš„ç´¯ç©äººæ•¸çµ±è¨ˆ -->

                <button onclick="resetQuiz()" class="w-full py-3 bg-gray-200 text-gray-700 font-bold rounded-lg hover:bg-gray-300 transition-colors">
                    é‡æ–°æ¸¬è©¦
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, getDocs, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // ç’°å¢ƒè®Šæ•¸
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = JSON.parse(typeof __firebase_config !== 'undefined' ? __firebase_config : '{}');
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const QUIZ_COLLECTION_PATH = `artifacts/${appId}/public/data/quiz_results_v2`; // ä½¿ç”¨ v2 å€éš”æ–°èˆŠè³‡æ–™

        // è®Šæ•¸
        let db, auth, userId, isAuthReady = false;

        // å•é¡Œåº« (ç¶­æŒä¸è®Š)
        const questions = [
            { id: 1, text: "æˆ‘ç¶“å¸¸æ“”å¿ƒä¼´ä¾¶ä¸åƒæˆ‘æ„›ä»–å€‘é‚£æ¨£æ„›æˆ‘ã€‚", dimension: 'anxiety' },
            { id: 2, text: "æˆ‘éœ€è¦ç¶“å¸¸å¾—åˆ°ä¼´ä¾¶çš„è‚¯å®šå’Œä¿è­‰ï¼Œæ‰èƒ½æ„Ÿåˆ°å®‰å¿ƒã€‚", dimension: 'anxiety' },
            { id: 3, text: "ç•¶ä¼´ä¾¶ç–é æˆ‘æ™‚ï¼Œæˆ‘æœƒæ„Ÿåˆ°éå¸¸ä¸å®‰ï¼Œä¸¦è©¦åœ–æ‹‰è¿‘è·é›¢ã€‚", dimension: 'anxiety' },
            { id: 4, text: "åœ¨é—œä¿‚ä¸­ï¼Œæˆ‘æœƒä»˜å‡ºå¾ˆå¤šï¼Œå³ä½¿å§”å±ˆè‡ªå·±ï¼Œä»¥ç¢ºä¿é—œä¿‚ç©©å®šã€‚", dimension: 'anxiety' },
            { id: 5, text: "æˆ‘å®³æ€•è¢«æ‹‹æ£„æˆ–è¢«æ‹’çµ•ï¼Œé€™æœƒå½±éŸ¿æˆ‘åœ¨é—œä¿‚ä¸­çš„è¡Œç‚ºã€‚", dimension: 'anxiety' },
            { id: 6, text: "æˆ‘æœ‰æ™‚æœƒéåº¦åˆ†æä¼´ä¾¶çš„è¨€è¡Œèˆ‰æ­¢ï¼Œå°‹æ‰¾æ½›åœ¨å•é¡Œçš„ç·šç´¢ã€‚", dimension: 'anxiety' },
            { id: 7, text: "å¦‚æœä¼´ä¾¶æ²’æœ‰å³æ™‚å›è¦†è¨Šæ¯æˆ–é›»è©±ï¼Œæˆ‘æœƒæ„Ÿåˆ°å¾ˆç„¦æ…®ã€‚", dimension: 'anxiety' },
            { id: 8, text: "æˆ‘æ¸´æœ›èˆ‡ä¼´ä¾¶å»ºç«‹éå¸¸è¦ªå¯†ä¸”ä¾è³´çš„é—œä¿‚ï¼Œæœ€å¥½æ˜¯å½¢å½±ä¸é›¢ã€‚", dimension: 'anxiety' },
            { id: 9, text: "æˆ‘å‚¾å‘æ–¼åœ¨è¡çªå¾Œä¸»å‹•ä¿®å¾©é—œä¿‚ï¼Œå³ä½¿ä¸å®Œå…¨æ˜¯æˆ‘çš„éŒ¯ã€‚", dimension: 'anxiety' },
            { id: 10, text: "æˆ‘çš„æƒ…ç·’ç¶“å¸¸å—åˆ°ä¼´ä¾¶è¡Œç‚ºçš„å½±éŸ¿è€Œèµ·ä¼ä¸å®šã€‚", dimension: 'anxiety' },
            { id: 11, text: "æˆ‘èªç‚ºåœ¨è¦ªå¯†é—œä¿‚ä¸­ä¿æŒç¨ç«‹å’Œå€‹äººç©ºé–“éå¸¸é‡è¦ã€‚", dimension: 'avoidance' },
            { id: 12, text: "ç•¶é—œä¿‚è®Šå¾—å¤ªè¦ªå¯†æ™‚ï¼Œæˆ‘æœƒæƒ³æ‹‰é–‹è·é›¢æˆ–æš«æ™‚æŠ½é›¢ã€‚", dimension: 'avoidance' },
            { id: 13, text: "æˆ‘ä¸å–œæ­¡ä¾è³´åˆ¥äººï¼Œä¹Ÿä¸å–œæ­¡åˆ¥äººå¤ªä¾è³´æˆ‘ã€‚", dimension: 'avoidance' },
            { id: 14, text: "ç™¼ç”Ÿçˆ­åŸ·æˆ–æƒ…æ„Ÿå£“åŠ›æ™‚ï¼Œæˆ‘é€šå¸¸é¸æ“‡å†·éœã€é€€å‡ºè¨è«–æˆ–ç¨è‡ªè§£æ±ºã€‚", dimension: 'avoidance' },
            { id: 15, text: "æˆ‘ç™¼ç¾å¾ˆé›£å‘ä¼´ä¾¶å¦ç™½æˆ‘å…§å¿ƒæ·±è™•çš„æƒ³æ³•æˆ–æ„Ÿå—ã€‚", dimension: 'avoidance' },
            { id: 16, text: "æˆ‘å¸¸å¸¸è¦ºå¾—ä¼´ä¾¶å°æˆ‘çš„è¦æ±‚éå¤šæˆ–éæ–¼é»è†©ã€‚", dimension: 'avoidance' },
            { id: 17, text: "ç¨è™•æ™‚æˆ‘æ„Ÿåˆ°æœ€èˆ’é©è‡ªåœ¨ï¼Œæ¯”èˆ‡ä¼´ä¾¶åœ¨ä¸€èµ·æ›´æ”¾é¬†ã€‚", dimension: 'avoidance' },
            { id: 18, text: "å³ä½¿æˆ‘å—å‚·æˆ–é›£éï¼Œæˆ‘ä¹Ÿæœƒé¿å…è®“ä¼´ä¾¶çœ‹åˆ°æˆ‘çš„è„†å¼±ã€‚", dimension: 'avoidance' },
            { id: 19, text: "æˆ‘æœƒé¿å…è¨è«–é—œä¿‚ä¸­å¯èƒ½å¼•èµ·æƒ…æ„Ÿæ³¢å‹•çš„è©±é¡Œã€‚", dimension: 'avoidance' },
            { id: 20, text: "æˆ‘åŠªåŠ›è®“è‡ªå·±ç›¸ä¿¡ï¼Œæˆ‘èƒ½å¤ è™•ç†ç”Ÿæ´»ä¸­çš„æ‰€æœ‰å•é¡Œï¼Œä¸éœ€è¦ä»–äººå¹«åŠ©ã€‚", dimension: 'avoidance' }
        ];

        // åˆå§‹åŒ–å•å·
        const questionsList = document.getElementById('questions-list');
        questions.forEach(q => {
            const div = document.createElement('div');
            div.className = "bg-white p-6 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow";
            div.innerHTML = `
                <div class="mb-4">
                    <span class="inline-block px-2 py-1 bg-gray-100 text-gray-500 text-xs font-bold rounded mb-2">Q${q.id}</span>
                    <p class="text-lg font-medium text-gray-800">${q.text}</p>
                </div>
                <div class="flex flex-col gap-2">
                    <div class="flex justify-between text-xs text-gray-400 font-bold">
                        <span>éå¸¸ä¸åŒæ„</span>
                        <span>éå¸¸åŒæ„</span>
                    </div>
                    <input type="range" min="1" max="5" value="3" data-dimension="${q.dimension}" class="slider" oninput="this.nextElementSibling.innerText = this.value">
                    <div class="text-center text-indigo-600 font-bold text-xl mt-1">3</div>
                </div>
            `;
            questionsList.appendChild(div);
        });

        // Firebase é‚è¼¯
        async function initFirebase() {
            try {
                const app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                
                if (initialAuthToken) await signInWithCustomToken(auth, initialAuthToken);
                else await signInAnonymously(auth);

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                        isAuthReady = true;
                        document.getElementById('loading-indicator').classList.add('hidden');
                        document.getElementById('submit-button').disabled = false;
                        // ç§»é™¤äº† updateCount() çš„èª¿ç”¨
                    }
                });
            } catch (e) {
                console.error("Firebase Error", e);
                document.getElementById('loading-indicator').innerText = "é€£ç·šå¤±æ•—ï¼Œè«‹é‡æ–°æ•´ç†é é¢ã€‚";
            }
        }

        // ç§»é™¤äº† updateCount() å‡½æ•¸

        // æ ¸å¿ƒåˆ†æé‚è¼¯
        window.calculateAndSaveResult = async function() {
            if (!isAuthReady) return;
            const btn = document.getElementById('submit-button');
            btn.disabled = true;
            btn.innerText = "åˆ†æä¸­...";

            const sliders = document.querySelectorAll('.slider');
            let anxietySum = 0, avoidanceSum = 0;
            sliders.forEach(s => {
                const val = parseInt(s.value);
                if (s.dataset.dimension === 'anxiety') anxietySum += val;
                else avoidanceSum += val;
            });

            // --- ä¿®æ­£å¾Œçš„é‚è¼¯ ---
            // æ»¿åˆ† 50ï¼Œæœ€ä½ 10ã€‚
            // åº§æ¨™åŒ–ï¼šå°‡åˆ†æ•¸è½‰æ›ç‚º 0% ~ 100% çš„ä½ç½®
            // 10åˆ† -> 0%, 30åˆ† -> 50%, 50åˆ† -> 100%
            const anxietyPercent = ((anxietySum - 10) / 40) * 100;
            const avoidancePercent = ((avoidanceSum - 10) / 40) * 100;

            // åš´æ ¼åˆ¤å®šï¼šå¤§æ–¼ 30 æ‰ç®—é«˜ (31åˆ†ä»¥ä¸Š)
            // æ¨¡ç³Šåœ°å¸¶ï¼š25-35 åˆ†ä¹‹é–“è¦–ç‚ºã€Œä¸­åº¦ã€æˆ–ã€Œå‚¾å‘ä¸æ˜é¡¯ã€
            const isHighAnx = anxietySum > 30;
            const isHighAvd = avoidanceSum > 30;
            
            let type = "", subtitle = "";
            let color = "";

            if (!isHighAnx && !isHighAvd) {
                type = "å®‰å…¨å‹ (Secure)";
                color = "text-green-600";
                subtitle = "æ‚¨åœ¨é—œä¿‚ä¸­æ„Ÿåˆ°èˆ’é©èˆ‡å®‰å…¨ï¼Œèƒ½å¹³è¡¡ç¨ç«‹èˆ‡è¦ªå¯†ã€‚";
            } else if (isHighAnx && !isHighAvd) {
                type = "ç„¦æ…®å‹ (Anxious)";
                color = "text-orange-500";
                subtitle = "æ‚¨æ¸´æœ›è¦ªå¯†ï¼Œä½†å¸¸æ“”å¿ƒè¢«å°æ–¹æ‹‹æ£„æˆ–ä¸å¤ æ„›è‡ªå·±ã€‚";
            } else if (!isHighAnx && isHighAvd) {
                type = "é€ƒé¿å‹ (Avoidant)";
                color = "text-blue-500";
                subtitle = "æ‚¨å‚¾å‘ä¿æŒè·é›¢èˆ‡ç¨ç«‹ï¼Œå°æ–¼éåº¦è¦ªå¯†æ„Ÿåˆ°ä¸è‡ªåœ¨ã€‚";
            } else {
                type = "æ··äº‚å‹ (Disorganized)";
                color = "text-red-500";
                subtitle = "æ‚¨æ—¢æ¸´æœ›è¦ªå¯†åˆå®³æ€•å—å‚·ï¼Œå…§å¿ƒå¸¸è™•æ–¼çŸ›ç›¾èˆ‡æ™æ‰ä¸­ã€‚";
            }

            // åŠ å…¥ã€Œæ¨¡ç³Šåœ°å¸¶ã€çš„è¨»è§£
            let caveat = "";
            if (Math.abs(anxietySum - 30) <= 5 && Math.abs(avoidanceSum - 30) <= 5) {
                caveat = "<br><br><strong>ğŸ’¡ åˆ†æå¸«ç­†è¨˜ï¼š</strong> æ‚¨çš„å„é …åˆ†æ•¸éå¸¸æ¥è¿‘ä¸­å¿ƒé»ï¼ˆ30åˆ†ï¼‰ã€‚é€™è¡¨ç¤ºæ‚¨çš„ä¾æˆ€é¢¨æ ¼å¯èƒ½ä¸æ˜é¡¯ï¼Œæˆ–è€…æ‚¨åœ¨ä¸åŒæƒ…å¢ƒä¸‹æœƒå±•ç¾ä¸åŒç‰¹è³ªï¼ˆå®‰å…¨å‹é‚Šç·£ï¼‰ã€‚å»ºè­°åƒè€ƒåº§æ¨™åœ–ä¸Šçš„è½é»æœƒæ¯”å–®ç´”çš„åˆ†é¡æ›´æº–ç¢ºã€‚";
            } else if (Math.abs(anxietySum - 30) <= 3) {
                caveat = "<br><br><strong>ğŸ’¡ åˆ†æå¸«ç­†è¨˜ï¼š</strong> æ‚¨çš„ã€Œç„¦æ…®æŒ‡æ•¸ã€ä½æ–¼ä¸­ç«‹å€é–“ï¼Œé€™ä»£è¡¨æ‚¨çš„ç„¦æ…®ç‰¹è³ªä¸¦ä¸å¼·çƒˆï¼Œå¯èƒ½åªåœ¨ç‰¹å®šå£“åŠ›ä¸‹æ‰æœƒå‡ºç¾ã€‚";
            } else if (Math.abs(avoidanceSum - 30) <= 3) {
                caveat = "<br><br><strong>ğŸ’¡ åˆ†æå¸«ç­†è¨˜ï¼š</strong> æ‚¨çš„ã€Œè¿´é¿æŒ‡æ•¸ã€ä½æ–¼ä¸­ç«‹å€é–“ï¼Œä»£è¡¨æ‚¨ä¸¦éå®Œå…¨æ’æ–¥è¦ªå¯†ï¼Œåªæ˜¯éœ€è¦ä¸€é»å€‹äººç©ºé–“ã€‚";
            }

            // æ›´æ–° UI
            document.getElementById('result-title').innerText = type;
            document.getElementById('result-title').className = `text-3xl font-extrabold mt-1 ${color}`;
            document.getElementById('result-subtitle').innerText = subtitle;
            document.getElementById('score-anxiety').innerText = anxietySum;
            document.getElementById('score-avoidance').innerText = avoidanceSum;
            document.getElementById('result-description').innerHTML = getDetailedDesc(type) + caveat;
            
            // æ›´æ–°åº§æ¨™é»ä½ç½®
            // Xè»¸: è¿´é¿ (å·¦ä½å³é«˜) -> left: avoidancePercent%
            // Yè»¸: ç„¦æ…® (ä¸‹ä½ä¸Šé«˜) -> bottom: anxietyPercent%
            const dot = document.getElementById('user-dot');
            dot.style.left = `${avoidancePercent}%`;
            dot.style.bottom = `${anxietyPercent}%`;

            // å„²å­˜è³‡æ–™ (ä¸é¡¯ç¤ºçµæœï¼Œä¹Ÿä¸ç”¨ updateCount)
            try {
                await addDoc(collection(db, QUIZ_COLLECTION_PATH), {
                    userId, anxietySum, avoidanceSum, type, timestamp: new Date().toISOString()
                });
                // ç§»é™¤äº† updateCount() çš„èª¿ç”¨å’Œçµæœé¡¯ç¤º
            } catch(e) { console.error(e); }

            document.getElementById('result-modal').classList.remove('hidden');
            btn.innerText = "æŸ¥çœ‹è©³ç´°åˆ†æå ±å‘Š";
            btn.disabled = false;
        };

        window.resetQuiz = function() {
            document.getElementById('result-modal').classList.add('hidden');
            document.querySelectorAll('.slider').forEach(s => { s.value = 3; s.nextElementSibling.innerText = "3"; });
            window.scrollTo(0,0);
        };

        function getDetailedDesc(type) {
            if (type.includes("å®‰å…¨")) return "å®‰å…¨å‹ä¾æˆ€è€…é€šå¸¸æ“æœ‰æ­£å‘çš„è‡ªæˆ‘åƒ¹å€¼æ„Ÿï¼Œä¹Ÿä¿¡ä»»ä»–äººã€‚é€™ä¸ä»£è¡¨æ‚¨åœ¨é—œä¿‚ä¸­å®Œå…¨æ²’æœ‰å•é¡Œï¼Œè€Œæ˜¯æ‚¨æœ‰èƒ½åŠ›é€éæºé€šèˆ‡èª¿ç¯€æƒ…ç·’ä¾†è§£æ±ºè¡çªï¼Œè€Œä¸æœƒæ¡å–éæ¿€çš„æŠ—è­°è¡Œç‚ºæˆ–å†·æš´åŠ›ã€‚";
            if (type.includes("ç„¦æ…®")) return "ç„¦æ…®å‹ä¾æˆ€è€…å°æ–¼ã€Œè¢«æ‹‹æ£„ã€éå¸¸æ•æ„Ÿã€‚æ‚¨éå¸¸å–„æ–¼å¯Ÿè¦ºä¼´ä¾¶çš„æƒ…ç·’è®ŠåŒ–ï¼Œä½†æœ‰æ™‚æœƒéåº¦è§£è®€ã€‚æ‚¨çš„æŒ‘æˆ°åœ¨æ–¼å­¸ç¿’è‡ªæˆ‘å®‰æ’«ï¼Œç›¸ä¿¡ã€Œä¼´ä¾¶ä¸åœ¨èº«é‚Šã€ä¸ç­‰æ–¼ã€Œä»–ä¸æ„›æˆ‘ã€ã€‚";
            if (type.includes("é€ƒé¿")) return "é€ƒé¿å‹ä¾æˆ€è€…å°‡ã€Œç¨ç«‹ã€è¦–ç‚ºæœ€é«˜åƒ¹å€¼ã€‚æ‚¨å¯èƒ½æœƒç„¡æ„è­˜åœ°å£“æŠ‘å°è¦ªå¯†çš„éœ€æ±‚ï¼Œç•¶ä¼´ä¾¶è©¦åœ–é è¿‘æ™‚ï¼Œæ‚¨æœƒæ„Ÿåˆ°çª’æ¯è€Œæƒ³é€ƒé›¢ã€‚æ‚¨çš„æŒ‘æˆ°æ˜¯ç†è§£ã€Œä¾è³´ã€ä¸¦ä¸æ˜¯è»Ÿå¼±ï¼Œè€Œæ˜¯é—œä¿‚çš„ä¸€éƒ¨åˆ†ã€‚";
            return "æ··äº‚å‹ä¾æˆ€è€…ï¼ˆåˆç¨±ææ‡¼-é€ƒé¿å‹ï¼‰å…§å¿ƒå¸¸æœ‰å…©è‚¡åŠ›é‡åœ¨æ‹‰æ‰¯ã€‚æ‚¨å¯èƒ½åœ¨ç«¥å¹´ç¶“æ­·éç„¡åŠ©çš„æ™‚åˆ»ï¼Œå°è‡´æ‚¨æƒ³é è¿‘äººå»åˆæ€•å—å‚·ã€‚é€™æ˜¯ä¸€ç¨®è‡ªæˆ‘ä¿è­·æ©Ÿåˆ¶ï¼Œå»ºè­°å°‹æ±‚å°ˆæ¥­è«®å•†å”åŠ©ï¼Œå»ºç«‹å…§åœ¨çš„å®‰å…¨åŸºåœ°ã€‚";
        }

        window.onload = initFirebase;
    </script>
</body>
</html>


= THRESHOLD;

            let resultKey;

            if (!isHighAnxiety && !isHighAvoidance) {
                resultKey = 'secure'; // ä½ç„¦æ…®, ä½è¿´é¿
            } else if (isHighAnxiety && !isHighAvoidance) {
                resultKey = 'anxious'; // é«˜ç„¦æ…®, ä½è¿´é¿
            } else if (!isHighAnxiety && isHighAvoidance) {
                resultKey = 'avoidant'; // ä½ç„¦æ…®, é«˜è¿´é¿
            } else {
                resultKey = 'disorganized'; // é«˜ç„¦æ…®, é«˜è¿´é¿
            }
            
            // é¡¯ç¤ºçµæœ
            const result = descriptions[resultKey];
            document.getElementById('attachment-style').textContent = result.style;
            document.getElementById('attachment-style').className = `font-extrabold text-2xl ${result.color}`;
            document.getElementById('anxiety-score').textContent = totalAnxietyScore;
            document.getElementById('avoidance-score').textContent = totalAvoidanceScore;
            document.getElementById('style-description').innerHTML = `
                <p class="font-bold text-lg mb-2 ${result.color}">${result.style} ç‰¹å¾µï¼š</p>
                <p>${result.description}</p>
            `;

            document.getElementById('result-modal').classList.remove('hidden');
        }

        // é‡æ–°é–‹å§‹æ¸¬é©—
        function resetQuiz() {
            document.getElementById('result-modal').classList.add('hidden');
            initQuiz();
        }

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–
        window.onload = initQuiz;
    </script>

</body>
</html>


