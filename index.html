<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>依戀屬性專業分析測驗 - 黑森林大叔</title>
    <!-- 引入 Tailwind CSS 進行排版 -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;700&display=swap');
        /* 使用 Noto Sans TC 確保中文字體顯示優化 */
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f0f2f5; }
        
        /* 滑塊樣式優化 */
        .slider { -webkit-appearance: none; width: 100%; height: 8px; background: #ddd; border-radius: 5px; outline: none; }
        .slider::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 22px; height: 22px; background: #4f46e5; border-radius: 50%; cursor: pointer; transition: 0.2s; }
        .slider::-webkit-slider-thumb:hover { transform: scale(1.1); }
        
        /* 座標圖樣式 */
        .quadrant-grid {
            position: relative;
            width: 300px;
            height: 300px;
            border: 2px solid #333;
            margin: 0 auto;
            /* 模擬座標軸線 */
            background-image: 
                linear-gradient(to bottom, #333 1px, transparent 1px),
                linear-gradient(to right, #333 1px, transparent 1px);
            background-size: 100% 150px, 150px 100%;
            background-position: 0 149px, 149px 0;
        }
        /* 軸線標籤 */
        .axis-label { position: absolute; font-size: 12px; color: #666; font-weight: bold; padding: 2px 4px; background: rgba(255,255,255,0.8); border-radius: 4px; }
        
        /* 使用者落點 (紅點) */
        .dot {
            position: absolute;
            width: 16px;
            height: 16px;
            background-color: #ef4444; /* 紅色 */
            border: 2px solid white;
            border-radius: 50%;
            /* 座標圖原點位於左下角 (0, 0)，但 CSS bottom/left 計算是從邊緣開始 */
            /* translate(-50%, 50%) 將點的中心對齊到 left 和 bottom 的百分比位置 */
            transform: translate(-50%, 50%); 
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: all 1s ease-out;
            z-index: 10;
        }
    </style>
</head>
<body class="min-h-screen p-4 flex flex-col items-center">

    <div class="w-full max-w-2xl bg-white shadow-xl rounded-2xl p-6 md:p-10 my-8">
        
        <!-- 商標顯示區 - 已替換為 SVG 佔位符確保顯示 -->
        <div class="text-center mb-6">
            <!-- 使用 SVG 虛擬 Logo 佔位符 -->
            <div class="mx-auto w-16 h-16 bg-indigo-600 rounded-full flex items-center justify-center mb-2 shadow-lg">
                <!-- 心理/分析相關的通用圖標 -->
                <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.621h.001M20 7.835h.001M19.14 15.36L15 19.5M17 14l2-2m-2-2h-3v3M6 14V7a2 2 0 012-2h4l4 4v3m-6 4v3m4-3v3m2-12l4-4h4l-4 4"></path></svg>
            </div>
            <h2 class="text-xl font-bold text-gray-800 tracking-widest">黑森林大叔</h2>
        </div>

        <header class="text-center mb-10 border-b pb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">依戀屬性專業分析</h1>
            <!-- 更新後的說明文字 -->
            <p class="text-gray-500 text-sm">請依照真實感受回答，</p>
            <p class="text-gray-500 text-sm">系統將為您進行落點分析。</p>
            <p class="text-xs text-red-500 mt-3 font-bold">［本測試僅供參考，如需準確分析請洽專業人員諮詢］</p>
            
            <div id="loading-indicator" class="mt-4 text-xs text-indigo-500 font-semibold animate-pulse hidden">
                <!-- 由於沒有外部資源，載入指示器預設隱藏，僅作為 UX 參考 -->
            </div>
        </header>

        <!-- 問題列表 -->
        <div id="questions-list" class="space-y-8">
            <!-- JavaScript 將自動生成題目 -->
        </div>
        
        <!-- 提交按鈕 -->
        <div class="mt-12">
            <button id="submit-button" class="w-full py-4 bg-indigo-600 text-white text-lg font-bold rounded-xl shadow-lg hover:bg-indigo-700 transition-all transform hover:-translate-y-1 disabled:bg-gray-400 disabled:cursor-not-allowed" onclick="calculateResult()">
                查看詳細分析報告
            </button>
            <p id="error-message" class="hidden mt-3 text-center text-red-500 font-medium">請回答所有問題後再提交。</p>
        </div>

    </div>

    <!-- 結果視窗 (Modal) -->
    <div id="result-modal" class="hidden fixed inset-0 bg-gray-900/90 flex items-center justify-center p-4 z-50 overflow-y-auto">
        <div class="bg-white rounded-2xl shadow-2xl w-full max-w-2xl overflow-hidden my-8 relative">
            
            <!-- 關閉按鈕 / 重新測試 -->
            <button onclick="resetQuiz()" class="absolute top-4 right-4 bg-indigo-600 p-2 rounded-full text-white hover:bg-indigo-700 z-10">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>
            </button>

            <!-- 報告標頭 -->
            <div class="bg-indigo-600 p-6 text-center text-white">
                <p class="opacity-80 text-sm tracking-widest mb-1">黑森林大叔</p>
                <h2 class="text-2xl font-bold">依戀屬性分析報告</h2>
            </div>

            <div class="p-6 md:p-8 space-y-6">
                
                <!-- 分析結果標題 -->
                <div class="text-center">
                    <p class="text-gray-500 text-xs uppercase tracking-wide">您的依戀類型傾向</p>
                    <h3 id="result-title" class="text-3xl font-extrabold text-gray-800 mt-1"></h3>
                    <p id="result-subtitle" class="text-indigo-600 font-medium mt-2 text-base"></p>
                </div>

                <!-- 視覺化座標圖 -->
                <div class="flex flex-col items-center justify-center py-6 bg-gray-50 rounded-xl border border-gray-200">
                    <p class="text-xs text-gray-400 mb-3 font-bold">您的心理落點座標圖 (迴避 x 焦慮)</p>
                    <div class="quadrant-grid relative bg-white shadow-inner">
                        <!-- 軸標籤 -->
                        <span class="axis-label top-1 left-1/2 -translate-x-1/2 text-red-600">高焦慮</span>
                        <span class="axis-label bottom-1 left-1/2 -translate-x-1/2 text-green-600">低焦慮</span>
                        <span class="axis-label top-1/2 right-1 -translate-y-1/2 text-blue-600">高迴避</span>
                        <span class="axis-label top-1/2 left-1 -translate-y-1/2 text-green-600">低迴避</span>
                        
                        <!-- 象限名稱 -->
                        <span class="absolute top-6 right-6 text-xs text-gray-300 font-bold pointer-events-none">混亂型</span>
                        <span class="absolute top-6 left-6 text-xs text-gray-300 font-bold pointer-events-none">焦慮型</span>
                        <span class="absolute bottom-6 right-6 text-xs text-gray-300 font-bold pointer-events-none">逃避型</span>
                        <span class="absolute bottom-6 left-6 text-xs text-gray-300 font-bold pointer-events-none">安全型</span>

                        <!-- 使用者落點 -->
                        <div id="user-dot" class="dot" style="bottom: 50%; left: 50%;"></div>
                    </div>
                    <p class="text-xs text-gray-400 mt-2">*紅點越接近中心，代表性格越趨於平衡安全</p>
                </div>

                <!-- 分數數值 (使用舊的 ID: score-anxiety/avoidance) -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-red-50 p-3 rounded-lg text-center border border-red-100">
                        <p class="text-xs text-red-500 font-bold mb-1">焦慮指數 (Anxiety)</p>
                        <p id="score-anxiety" class="text-2xl font-black text-red-600">0</p>
                        <p class="text-[10px] text-gray-400">分數越高代表越容易焦慮</p>
                    </div>
                    <div class="bg-blue-50 p-3 rounded-lg text-center border border-blue-100">
                        <p class="text-xs text-blue-500 font-bold mb-1">迴避指數 (Avoidance)</p>
                        <p id="score-avoidance" class="text-2xl font-black text-blue-600">0</p>
                        <p class="text-[10px] text-gray-400">分數越高代表越習慣逃避</p>
                    </div>
                </div>

                <!-- 詳細文字解釋 (使用舊的 ID: result-description) -->
                <div id="result-description" class="text-gray-700 text-sm leading-relaxed bg-gray-50 p-5 rounded-lg border-l-4 border-indigo-500 shadow-sm">
                    <!-- JS 動態插入描述 -->
                </div>

                <button onclick="resetQuiz()" class="w-full py-3 bg-gray-800 text-white font-bold rounded-lg hover:bg-gray-900 transition-colors shadow-lg">
                    重新測試
                </button>
            </div>
        </div>
    </div>

    <script type="module">
        // 問卷問題定義 (共 20 題，每維度 10 題)
        const questions = [
            // 焦慮型依戀 (Anxiety) - 10 題
            { id: 1, text: "我經常擔心伴侶不像我愛他們那樣愛我。", dimension: 'anxiety' },
            { id: 2, text: "我需要經常得到伴侶的肯定和保證，才能感到安心。", dimension: 'anxiety' },
            { id: 3, text: "當伴侶疏遠我時，我會感到非常不安，並試圖拉近距離。", dimension: 'anxiety' },
            { id: 4, text: "在關係中，我會付出很多，即使委屈自己，以確保關係穩定。", dimension: 'anxiety' },
            { id: 5, text: "我害怕被拋棄或被拒絕，這會影響我在關係中的行為。", dimension: 'anxiety' },
            { id: 6, text: "我有時會過度分析伴侶的言行舉止，尋找潛在問題的線索。", dimension: 'anxiety' },
            { id: 7, text: "如果伴侶沒有即時回覆訊息或電話，我會感到很焦慮。", dimension: 'anxiety' },
            { id: 8, text: "我渴望與伴侶建立非常親密且依賴的關係，最好是形影不離。", dimension: 'anxiety' },
            { id: 9, text: "我傾向於在衝突後主動修復關係，即使不完全是我的錯。", dimension: 'anxiety' },
            { id: 10, text: "我的情緒經常受到伴侶行為的影響而起伏不定。", dimension: 'anxiety' },
            
            // 逃避型依戀 (Avoidance) - 10 題
            { id: 11, text: "我認為在親密關係中保持獨立和個人空間非常重要。", dimension: 'avoidance' },
            { id: 12, text: "當關係變得太親密時，我會想拉開距離或暫時抽離。", dimension: 'avoidance' },
            { id: 13, text: "我不喜歡依賴別人，也不喜歡別人太依賴我。", dimension: 'avoidance' },
            { id: 14, text: "發生爭執或情感壓力時，我通常選擇冷靜、退出討論或獨自解決。", dimension: 'avoidance' },
            { id: 15, text: "我發現很難向伴侶坦白我內心深處的想法或感受。", dimension: 'avoidance' },
            { id: 16, text: "我常常覺得伴侶對我的要求過多或過於黏膩。", dimension: 'avoidance' },
            { id: 17, text: "獨處時我感到最舒適自在，比與伴侶在一起更放鬆。", dimension: 'avoidance' },
            { id: 18, text: "即使我受傷或難過，我也會避免讓伴侶看到我的脆弱。", dimension: 'avoidance' },
            { id: 19, text: "我會避免討論關係中可能引起情感波動的話題。", dimension: 'avoidance' },
            { id: 20, text: "我努力讓自己相信，我能夠處理生活中的所有問題，不需要他人幫助。", dimension: 'avoidance' }
        ];

        // 依戀屬性描述物件 (取自您提供的程式碼)
        const descriptions = {
            secure: {
                style: "安全型依戀 (Secure)",
                subtitle: "您擁有正向的自我價值感，並在關係中感到安全與舒適。",
                color: "text-green-600",
                description: "恭喜您！安全型依戀者對親密關係抱持積極態度。您在關係中既能獨立自主，也能在需要時尋求支持。您相信自己值得被愛，也相信伴侶是可靠的。這有助於建立穩定、和諧的長期關係。"
            },
            anxious: {
                style: "焦慮型依戀 (Anxious-Preoccupied)",
                subtitle: "您非常渴望親密，但常因擔心被拋棄而過度投入或擔憂。",
                color: "text-orange-600",
                description: "焦慮型依戀者渴望親密但又充滿不安全感。您可能容易患得患失，需要伴侶不斷地確認和保證。請嘗試學習**自我安撫**，並相信您的價值不依賴於伴侶的行為。"
            },
            avoidant: {
                style: "逃避型依戀 (Avoidant-Dismissing)",
                subtitle: "您傾向保持獨立和個人空間，對於過度親密感到不自在。",
                color: "text-blue-600",
                description: "逃避型依戀者高度重視獨立和個人空間。當關係變得親密時，您可能會傾向於拉開距離或迴避情感交流。請嘗試練習**情感表達**，允許自己在關係中展現脆弱，以建立更深層的連結。"
            },
            disorganized: {
                style: "混亂型依戀 (Disorganized/Fearful-Avoidant)",
                subtitle: "您既渴望親密又害怕受傷，內心常有矛盾的拉扯與掙扎。",
                color: "text-red-600",
                description: "混亂型依戀者（又稱恐懼-逃避型）內心常有兩股力量在拉扯。您既渴望親密又害怕親密，這導致關係中的行為模式不穩定且充滿矛盾。這通常與童年複雜的依戀經驗有關。建議尋求**專業支持**，幫助建立更一致的內在安全感。"
            }
        };

        const THRESHOLD = 30; // 總分 10-50，臨界值 30 (10題*3分)
        const questionsList = document.getElementById('questions-list');
        const submitButton = document.getElementById('submit-button');

        // 初始化問卷介面
        function initQuiz() {
            questionsList.innerHTML = '';
            questions.forEach(q => {
                const div = document.createElement('div');
                div.className = "bg-white p-5 rounded-xl border border-gray-100 shadow-sm hover:shadow-md transition-shadow question-wrapper"; 
                div.innerHTML = `
                    <div class="mb-4">
                        <span class="inline-block px-2 py-1 bg-gray-100 text-gray-500 text-xs font-bold rounded mb-2">Q${q.id}</span>
                        <p class="text-base font-medium text-gray-800">${q.text}</p>
                    </div>
                    <div class="flex flex-col gap-2">
                        <div class="flex justify-between text-xs text-gray-400 font-bold px-1">
                            <span>非常不同意 (1)</span>
                            <span>非常同意 (5)</span>
                        </div>
                        <div class="relative flex items-center">
                            <input type="range" min="1" max="5" value="3" data-id="${q.id}" data-dimension="${q.dimension}" class="slider z-10" 
                                   oninput="updateSliderValue(this)">
                        </div>
                        <div class="text-center text-indigo-600 font-bold text-lg mt-1 output-val" id="value-${q.id}">3</div>
                    </div>
                `;
                questionsList.appendChild(div);
            });
            // 啟用按鈕 (因為沒有外部依賴，可立即啟用)
            submitButton.disabled = false;
            document.getElementById('error-message').classList.add('hidden');
        }

        // 更新滑塊顯示的數值
        function updateSliderValue(slider) {
            document.getElementById(`value-${slider.dataset.id}`).textContent = slider.value;
        }

        // 核心分析邏輯
        window.calculateResult = async function() {
            const btn = document.getElementById('submit-button');
            const originalBtnText = btn.innerText;
            
            btn.disabled = true;
            btn.innerText = "正在分析數據...";

            const sliders = document.querySelectorAll('.slider');
            let anxietySum = 0, avoidanceSum = 0;

            // 在本簡化模型中，所有滑塊都有預設值 3，所以一定有回答。
            sliders.forEach(s => {
                const val = parseInt(s.value, 10);
                if (s.dataset.dimension === 'anxiety') anxietySum += val;
                else avoidanceSum += val;
            });

            // 決定依戀類型
            const isHighAnx = anxietySum >= THRESHOLD;
            const isHighAvd = avoidanceSum >= THRESHOLD;
            
            let resultKey;

            if (!isHighAnx && !isHighAvd) {
                resultKey = 'secure'; // 低焦慮, 低迴避
            } else if (isHighAnx && !isHighAvd) {
                resultKey = 'anxious'; // 高焦慮, 低迴避
            } else if (!isHighAnx && isHighAvd) {
                resultKey = 'avoidant'; // 低焦慮, 高迴避
            } else {
                resultKey = 'disorganized'; // 高焦慮, 高迴避
            }

            const result = descriptions[resultKey];

            // --- 座標圖視覺化計算 ---
            // 總分範圍：10 (min) ~ 50 (max)
            // 轉換為 0% ~ 100% 座標 (0% = 10分; 100% = 50分)
            const anxietyPercent = ((anxietySum - 10) / 40) * 100;
            const avoidancePercent = ((avoidanceSum - 10) / 40) * 100;

            // 更新 UI 顯示 (使用 index.html 中既有的 ID)
            document.getElementById('result-title').innerText = result.style;
            document.getElementById('result-title').className = `text-3xl font-extrabold mt-1 ${result.color}`;
            document.getElementById('result-subtitle').innerText = result.subtitle;
            document.getElementById('score-anxiety').innerText = anxietySum;
            document.getElementById('score-avoidance').innerText = avoidanceSum;
            
            document.getElementById('result-description').innerHTML = `
                <p class="font-bold text-lg mb-2 ${result.color}">${result.style} 特徵：</p>
                <p>${result.description}</p>
            `;
            
            // 更新座標點位置
            const dot = document.getElementById('user-dot');
            dot.style.left = `${avoidancePercent}%`;
            // 注意：焦慮分數越高，點應該越「高」，即 bottom 數值越大
            dot.style.bottom = `${anxietyPercent}%`;

            // 顯示結果 Modal
            document.getElementById('result-modal').classList.remove('hidden');
            btn.innerText = originalBtnText; // 恢復按鈕文字
            btn.disabled = false;
        };

        // 重新開始測驗
        window.resetQuiz = function() {
            document.getElementById('result-modal').classList.add('hidden');
            initQuiz();
            window.scrollTo(0,0);
        };

        window.onload = initQuiz;
    </script>
</body>
</html>

